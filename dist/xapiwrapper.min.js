/*! xAPIWrapper v 1.10.1 | Built on 2019-02-18 16:58:54+0000 */
(function(root, factory){
    // text-encoder uses module.exports which isn't allowed inside
    // the main closure as it breaks the module export in node
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(function () {
            return factory({}, root, root);
        });
    } else if (typeof exports === 'object' && typeof exports.nodeName !== 'string') {
        // CommonJS
        module.exports = factory({}, root, root);
    } else {
        // Browser roots
        root.ADL = factory({}, root, root);
    }
}(typeof self !== 'undefined' ? self : this, function (module, window, root) {var ADL = {};
var CryptoJS=(CryptoJS=CryptoJS||function(u,t){var e={},n=e.lib={},i=n.Base=function(){function n(){}return{extend:function(t){n.prototype=this;var e=new n;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),(e.init.prototype=e).$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),l=n.WordArray=i.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||s).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes,r=t.sigBytes;if(this.clamp(),i%4)for(var s=0;s<r;s++){var o=n[s>>>2]>>>24-s%4*8&255;e[i+s>>>2]|=o<<24-(i+s)%4*8}else if(65535<n.length)for(s=0;s<r;s+=4)e[i+s>>>2]=n[s>>>2];else e.push.apply(e,n);return this.sigBytes+=r,this},clamp:function(){var t=this.words,e=this.sigBytes;t[e>>>2]&=4294967295<<32-e%4*8,t.length=u.ceil(e/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],n=0;n<t;n+=4)e.push(4294967296*u.random()|0);return new l.init(e,t)}}),r=e.enc={},s=r.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,i=[],r=0;r<n;r++){var s=e[r>>>2]>>>24-r%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new l.init(n,e/2)}},o=r.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,i=[],r=0;r<n;r++){var s=e[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new l.init(n,e)}},a=r.Utf8={stringify:function(t){try{return decodeURIComponent(escape(o.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return o.parse(unescape(encodeURIComponent(t)))}},p=(r.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,i=this._map;t.clamp();for(var r=[],s=0;s<n;s+=3)for(var o=(e[s>>>2]>>>24-s%4*8&255)<<16|(e[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|e[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;a<4&&s+.75*a<n;a++)r.push(i.charAt(o>>>6*(3-a)&63));var p=i.charAt(64);if(p)for(;r.length%4;)r.push(p);return r.join("")},parse:function(t){var e=t.length,n=this._map,i=n.charAt(64);if(i){var r=t.indexOf(i);-1!=r&&(e=r)}for(var s=[],o=0,a=0;a<e;a++)if(a%4){var p=n.indexOf(t.charAt(a-1))<<a%4*2,c=n.indexOf(t.charAt(a))>>>6-a%4*2;s[o>>>2]|=(p|c)<<24-o%4*8,o++}return l.create(s,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=a.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var e=this._data,n=e.words,i=e.sigBytes,r=this.blockSize,s=i/(4*r),o=(s=t?u.ceil(s):u.max((0|s)-this._minBufferSize,0))*r,a=u.min(4*o,i);if(o){for(var p=0;p<o;p+=r)this._doProcessBlock(n,p);var c=n.splice(0,o);e.sigBytes-=a}return new l.init(c,a)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0})),c=n.Hasher=p.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(t,e){return new n.init(e).finalize(t)}},_createHmacHelper:function(n){return function(t,e){return new h.HMAC.init(n,e).finalize(t)}}}),h=e.algo={},d=[],f=h.SHA1=c.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],p=0;p<80;p++){if(p<16)d[p]=0|t[e+p];else{var c=d[p-3]^d[p-8]^d[p-14]^d[p-16];d[p]=c<<1|c>>>31}var u=(i<<5|i>>>27)+a+d[p];u+=p<20?1518500249+(r&s|~r&o):p<40?1859775393+(r^s^o):p<60?(r&s|r&o|s&o)-1894007588:(r^s^o)-899497514,a=o,o=s,s=r<<30|r>>>2,r=i,i=u}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[14+(i+64>>>9<<4)]=u.floor(n/4294967296),e[15+(i+64>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=c.clone.call(this);return t._hash=this._hash.clone(),t}});return e.SHA1=c._createHelper(f),e.HmacSHA1=c._createHmacHelper(f),e}(Math))||function(a,t){var e={},n=e.lib={},i=function(){},r=n.Base={extend:function(t){i.prototype=this;var e=new i;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),(e.init.prototype=e).$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},p=n.WordArray=r.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||o).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes;if(t=t.sigBytes,this.clamp(),i%4)for(var r=0;r<t;r++)e[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<t;r+=4)e[i+r>>>2]=n[r>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var t=this.words,e=this.sigBytes;t[e>>>2]&=4294967295<<32-e%4*8,t.length=a.ceil(e/4)},clone:function(){var t=r.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],n=0;n<t;n+=4)e.push(4294967296*a.random()|0);return new p.init(e,t)}}),s=e.enc={},o=s.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;i<t;i++){var r=e[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new p.init(n,e/2)}},c=s.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;i<t;i++)n.push(String.fromCharCode(e[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new p.init(n,e)}},u=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},l=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new p.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var e=this._data,n=e.words,i=e.sigBytes,r=this.blockSize,s=i/(4*r);if(t=(s=t?a.ceil(s):a.max((0|s)-this._minBufferSize,0))*r,i=a.min(4*t,i),t){for(var o=0;o<t;o+=r)this._doProcessBlock(n,o);o=n.splice(0,t),e.sigBytes-=i}return new p.init(o,i)},clone:function(){var t=r.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});n.Hasher=l.extend({cfg:r.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(t,e){return new n.init(e).finalize(t)}},_createHmacHelper:function(n){return function(t,e){return new h.HMAC.init(n,e).finalize(t)}}});var h=e.algo={};return e}(Math);function toBase64(t){return CryptoJS&&CryptoJS.enc.Base64?CryptoJS.enc.Base64.stringify(CryptoJS.enc.Latin1.parse(t)):Base64.encode(t)}function toSHA1(t){return CryptoJS&&CryptoJS.SHA1?CryptoJS.SHA1(t).toString():Crypto.util.bytesToHex(Crypto.SHA1(t,{asBytes:!0}))}function toSHA256(t){if("[object ArrayBuffer]"!==Object.prototype.toString.call(t))return CryptoJS.SHA256(t).toString(CryptoJS.enc.Hex);for(var e=new Uint8Array(t),n=[],i=0;i<e.length;i+=4)n.push(e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]);return CryptoJS.SHA256(CryptoJS.lib.WordArray.create(n,e.length)).toString(CryptoJS.enc.Hex)}function isDate(t){if("[object Date]"===Object.prototype.toString.call(t))var e=t;else e=new Date(t);return"[object Date]"===Object.prototype.toString.call(e)?isNaN(e.valueOf())?(ADL.XAPIWrapper.log("Invalid date String passed"),null):e:(ADL.XAPIWrapper.log("Invalid date object"),null)}function getByteLen(t){t=String(t);for(var e=0,n=0;n<t.length;n++){var i=t.charCodeAt(n);e+=i<128?1:i<2048?2:i<65536?3:i<1<<21?4:i<1<<26?5:i<1<<31?6:Number.NaN}return e}!function(r){for(var t=CryptoJS,e=(i=t.lib).WordArray,n=i.Hasher,i=t.algo,s=[],f=[],o=function(t){return 4294967296*(t-(0|t))|0},a=2,p=0;p<64;){var c;t:{c=a;for(var u=r.sqrt(c),l=2;l<=u;l++)if(!(c%l)){c=!1;break t}c=!0}c&&(p<8&&(s[p]=o(r.pow(a,.5))),f[p]=o(r.pow(a,1/3)),p++),a++}var g=[];i=i.SHA256=n.extend({_doReset:function(){this._hash=new e.init(s.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],p=n[5],c=n[6],u=n[7],l=0;l<64;l++){if(l<16)g[l]=0|t[e+l];else{var h=g[l-15],d=g[l-2];g[l]=((h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3)+g[l-7]+((d<<15|d>>>17)^(d<<13|d>>>19)^d>>>10)+g[l-16]}h=u+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&p^~a&c)+f[l]+g[l],d=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&r^i&s^r&s),u=c,c=p,p=a,a=o+h|0,o=s,s=r,r=i,i=h+d|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0,n[5]=n[5]+p|0,n[6]=n[6]+c|0,n[7]=n[7]+u|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[14+(i+64>>>9<<4)]=r.floor(n/4294967296),e[15+(i+64>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA256=n._createHelper(i),t.HmacSHA256=n._createHmacHelper(i)}(Math),function(){var t=CryptoJS,c=t.enc.Utf8;t.algo.HMAC=t.lib.Base.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=c.parse(e));var n=t.blockSize,i=4*n;e.sigBytes>i&&(e=t.finalize(e)),e.clamp();for(var r=this._oKey=e.clone(),s=this._iKey=e.clone(),o=r.words,a=s.words,p=0;p<n;p++)o[p]^=1549556828,a[p]^=909522486;r.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;return t=e.finalize(t),e.reset(),e.finalize(this._oKey.clone().concat(t))}})}(),function(t){if(void 0===n){function e(t){if("utf8"!==t)throw"TextDecoder only supports utf8"}e.prototype.encode=function(t){for(var e=[],n=t.length,i=0;i<n;){var r=t.codePointAt(i),s=0,o=0;for(r<=127?o=s=0:r<=2047?(s=6,o=192):r<=65535?(s=12,o=224):r<=2097151&&(s=18,o=240),e.push(o|r>>s),s-=6;0<=s;)e.push(128|r>>s&63),s-=6;i+=65536<=r?2:1}return e},t.TextEncoder=e}if(void 0===n){function n(t){if("utf8"!==t)throw"TextDecoder only supports utf8"}n.prototype.decode=function(t){for(var e="",n=0;n<t.length;){var i=t[n],r=0,s=0;if(i<=127?(r=0,s=255&i):i<=223?(r=1,s=31&i):i<=239?(r=2,s=15&i):i<=244&&(r=3,s=7&i),0<t.length-n-r)for(var o=0;o<r;)s=s<<6|63&(i=t[n+o+1]),o+=1;else s=65533,r=t.length-n;e+=String.fromCodePoint(s),n+=r+1}return e},t.TextDecoder=n}}(this),ADL.activityTypes={assessment:"http://adlnet.gov/expapi/activities/assessment",attempt:"http://adlnet.gov/expapi/activities/attempt",course:"http://adlnet.gov/expapi/activities/course",file:"http://adlnet.gov/expapi/activities/file",interaction:"http://adlnet.gov/expapi/activities/interaction",lesson:"http://adlnet.gov/expapi/activities/lesson",link:"http://adlnet.gov/expapi/activities/link",media:"http://adlnet.gov/expapi/activities/media",meeting:"http://adlnet.gov/expapi/activities/meeting",module:"http://adlnet.gov/expapi/activities/module",objective:"http://adlnet.gov/expapi/activities/objective",performance:"http://adlnet.gov/expapi/activities/performance",profile:"http://adlnet.gov/expapi/activities/profile",question:"http://adlnet.gov/expapi/activities/question",simulation:"http://adlnet.gov/expapi/activities/simulation"},ADL.verbs={abandoned:{id:"https://w3id.org/xapi/adl/verbs/abandoned",display:{"en-US":"abandoned"}},answered:{id:"http://adlnet.gov/expapi/verbs/answered",display:{"de-DE":"beantwortete","en-US":"answered","fr-FR":"a répondu","es-ES":"contestó","ar-AR":"أجاب"}},asked:{id:"http://adlnet.gov/expapi/verbs/asked",display:{"de-DE":"fragte","en-US":"asked","fr-FR":"a demandé","es-ES":"preguntó","ar-AR":"طلب"}},attempted:{id:"http://adlnet.gov/expapi/verbs/attempted",display:{"de-DE":"versuchte","en-US":"attempted","fr-FR":"a essayé","es-ES":"intentó","ar-AR":"حاول"}},attended:{id:"http://adlnet.gov/expapi/verbs/attended",display:{"de-DE":"nahm teil an","en-US":"attended","fr-FR":"a suivi","es-ES":"asistió","ar-AR":"حضر"}},commented:{id:"http://adlnet.gov/expapi/verbs/commented",display:{"de-DE":"kommentierte","en-US":"commented","fr-FR":"a commenté","es-ES":"comentó","ar-AR":"علق"}},completed:{id:"http://adlnet.gov/expapi/verbs/completed",display:{"de-DE":"beendete","en-US":"completed","fr-FR":"a terminé","es-ES":"completó","ar-AR":"أكمل"}},exited:{id:"http://adlnet.gov/expapi/verbs/exited",display:{"de-DE":"verließ","en-US":"exited","fr-FR":"a quitté","es-ES":"salió","ar-AR":"خرج"}},experienced:{id:"http://adlnet.gov/expapi/verbs/experienced",display:{"de-DE":"erlebte","en-US":"experienced","fr-FR":"a éprouvé","es-ES":"experimentó","ar-AR":"شاهد"}},failed:{id:"http://adlnet.gov/expapi/verbs/failed",display:{"de-DE":"verfehlte","en-US":"failed","fr-FR":"a échoué","es-ES":"fracasó","ar-AR":"فشل"}},imported:{id:"http://adlnet.gov/expapi/verbs/imported",display:{"de-DE":"importierte","en-US":"imported","fr-FR":"a importé","es-ES":"importó","ar-AR":"مستورد"}},initialized:{id:"http://adlnet.gov/expapi/verbs/initialized",display:{"de-DE":"initialisierte","en-US":"initialized","fr-FR":"a initialisé","es-ES":"inicializó","ar-AR":"بدأ"}},interacted:{id:"http://adlnet.gov/expapi/verbs/interacted",display:{"de-DE":"interagierte","en-US":"interacted","fr-FR":"a interagi","es-ES":"interactuó","ar-AR":"تفاعل"}},launched:{id:"http://adlnet.gov/expapi/verbs/launched",display:{"de-DE":"startete","en-US":"launched","fr-FR":"a lancé","es-ES":"lanzó","ar-AR":"أطلق"}},mastered:{id:"http://adlnet.gov/expapi/verbs/mastered",display:{"de-DE":"meisterte","en-US":"mastered","fr-FR":"a maîtrisé","es-ES":"dominó","ar-AR":"أتقن"}},passed:{id:"http://adlnet.gov/expapi/verbs/passed",display:{"de-DE":"bestand","en-US":"passed","fr-FR":"a réussi","es-ES":"aprobó","ar-AR":"نجح"}},preferred:{id:"http://adlnet.gov/expapi/verbs/preferred",display:{"de-DE":"bevorzugte","en-US":"preferred","fr-FR":"a préféré","es-ES":"prefirió","ar-AR":"فضل"}},progressed:{id:"http://adlnet.gov/expapi/verbs/progressed",display:{"de-DE":"machte Fortschritt mit","en-US":"progressed","fr-FR":"a progressé","es-ES":"progresó","ar-AR":"تقدم"}},registered:{id:"http://adlnet.gov/expapi/verbs/registered",display:{"de-DE":"registrierte","en-US":"registered","fr-FR":"a enregistré","es-ES":"registró","ar-AR":"سجل"}},responded:{id:"http://adlnet.gov/expapi/verbs/responded",display:{"de-DE":"reagierte","en-US":"responded","fr-FR":"a répondu","es-ES":"respondió","ar-AR":"استجاب"}},resumed:{id:"http://adlnet.gov/expapi/verbs/resumed",display:{"de-DE":"setzte fort","en-US":"resumed","fr-FR":"a repris","es-ES":"continuó","ar-AR":"استأنف"}},satisfied:{id:"https://w3id.org/xapi/adl/verbs/satisfied",display:{"de-DE":"befriedigt","en-US":"satisfied","fr-FR":"satisfaite","es-ES":"satisfecho","ar-AR":"راض"}},scored:{id:"http://adlnet.gov/expapi/verbs/scored",display:{"de-DE":"erreichte","en-US":"scored","fr-FR":"a marqué","es-ES":"anotó","ar-AR":"سحل النقاط"}},shared:{id:"http://adlnet.gov/expapi/verbs/shared",display:{"de-DE":"teilte","en-US":"shared","fr-FR":"a partagé","es-ES":"compartió","ar-AR":"شارك"}},suspended:{id:"http://adlnet.gov/expapi/verbs/suspended",display:{"de-DE":"pausierte","en-US":"suspended","fr-FR":"a suspendu","es-ES":"aplazó","ar-AR":"علق"}},terminated:{id:"http://adlnet.gov/expapi/verbs/terminated",display:{"de-DE":"beendete","en-US":"terminated","fr-FR":"a terminé","es-ES":"terminó","ar-AR":"أنهى"}},voided:{id:"http://adlnet.gov/expapi/verbs/voided",display:{"de-DE":"entwertete","en-US":"voided","fr-FR":"a annulé","es-ES":"anuló","ar-AR":"فرغ"}},waived:{id:"https://w3id.org/xapi/adl/verbs/waived",display:{"de-DE":"verzichtet","en-US":"waived","fr-FR":"renoncé","es-ES":"renunciado","ar-AR":"تخلى"}}},Date.prototype.toISOString||function(){function t(t){var e=String(t);return 1===e.length&&(e="0"+e),e}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}(),log.debug=!1;var Config=function(){var t={endpoint:"http://localhost:8000/xapi/"};return t.auth="Basic "+toBase64("tom:1234"),t}(),XAPIWrapper=function(t,e){function n(t){var e=parseUrl(t);if(e.protocol&&e.host)return e.protocol+"//"+e.host;if(e.href){var n=e.href.split("//");return n[0]+"//"+n[1].substr(0,n[1].indexOf("/"))}ADL.XAPIWrapper.log("Couldn't create base url from endpoint: "+t)}function i(t,e,n){t.auth="Basic "+toBase64(e+":"+n)}this.lrs=getLRSObject(t||{}),this.lrs.user&&this.lrs.password&&i(this.lrs,this.lrs.user,this.lrs.password),this.base=n(this.lrs.endpoint),this.withCredentials=!1,t&&void 0!==t.withCredentials&&(this.withCredentials=t.withCredentials),this.strictCallbacks=!1,this.strictCallbacks=t&&t.strictCallbacks,e&&testConfig.call(this)&&ADL.XHR_request(this.lrs,this.lrs.endpoint+"about","GET",null,null,function(t){if(200==t.status)try{var e=JSON.parse(t.response),n=!1;for(var i in e.version)if(e.version.hasOwnProperty(i)&&e.version[i]==ADL.XAPIWrapper.xapiVersion){n=!0;break}n||ADL.XAPIWrapper.log("The lrs version ["+e.version+"] does not match this wrapper's XAPI version ["+ADL.XAPIWrapper.xapiVersion+"]")}catch(t){ADL.XAPIWrapper.log("The response was not an about object")}else ADL.XAPIWrapper.log("The request to get information about the LRS failed: "+t)},null,!1,null,this.withCredentials,!1),this.searchParams=function(){return{format:"exact"}},this.hash=function(t){if(!t)return null;try{return toSHA1(t)}catch(t){return ADL.XAPIWrapper.log("Error trying to hash -- "+t),null}},this.changeConfig=function(t){try{ADL.XAPIWrapper.log("updating lrs object with new configuration"),this.lrs=mergeRecursive(this.lrs,t),t.user&&t.password&&this.updateAuth(this.lrs,t.user,t.password),this.base=n(this.lrs.endpoint),this.withCredentials=t.withCredentials,this.strictCallbacks=t.strictCallbacks}catch(t){ADL.XAPIWrapper.log("error while changing configuration -- "+t)}},this.updateAuth=i};function testConfig(){try{return null!=this.lrs.endpoint&&""!=this.lrs.endpoint}catch(t){return!1}}function log(t){if(!log.debug)return!1;try{return console.log(t),!0}catch(t){return!1}}function mergeRecursive(e,n){for(var i in n)if(0!=n.hasOwnProperty(i)){log(i+" : "+n[i]);try{n[i].constructor==Object?e[i]=mergeRecursive(e[i],n[i]):(null==e&&(e=new Object),e[i]=n[i])}catch(t){null==e&&(e=new Object),e[i]=n[i]}}return e}function getLRSObject(t){var e,n,i=["endpoint","auth","actor","registration","activity_id","grouping","activity_platform"],r=new Object;if(void 0!==(e=parseQueryString())&&0!==Object.keys(e).length){for(var s=0;s<i.length;s++)e[n=i[s]]&&(r[n]=e[n],delete e[n]);0!==Object.keys(e).length&&(r.extended=e),r=mergeRecursive(t,r)}else r=t;return r}function parseQueryString(){var t,e,n,i;for(t=location.search.substr(1).split("&"),i={},n=0;n<t.length;n++)2===(e=t[n].split("=")).length&&e[0]&&(i[e[0]]=decodeURIComponent(e[1]));return i}function delay(){var t=new XMLHttpRequest,e=location+"?forcenocache="+ADL.ruuid();t.open("GET",e,!1),t.send(null)}XAPIWrapper.prototype.xapiVersion="1.0.1",XAPIWrapper.prototype.prepareStatement=function(t){void 0===t.actor?t.actor=JSON.parse(this.lrs.actor):"string"==typeof t.actor&&(t.actor=JSON.parse(t.actor)),(this.lrs.grouping||this.lrs.registration||this.lrs.activity_platform)&&(t.context||(t.context={})),this.lrs.grouping&&(t.context.contextActivities||(t.context.contextActivities={}),t.context.contextActivities.grouping=[{id:this.lrs.grouping}]),this.lrs.registration&&(t.context.registration=this.lrs.registration),this.lrs.activity_platform&&(t.context.platform=this.lrs.activity_platform)},XAPIWrapper.prototype.testConfig=testConfig,XAPIWrapper.prototype.log=log,XAPIWrapper.prototype.defaultEncoding="utf-8",XAPIWrapper.prototype.sendStatement=function(t,e,n){if(this.testConfig()){var i;this.prepareStatement(t),t.id?i=t.id:(i=ADL.ruuid(),t.id=i);var r=JSON.stringify(t),s=null;n&&0<n.length&&(s={},r=this.buildMultipartPost(t,n,s));var o=ADL.XHR_request(this.lrs,this.lrs.endpoint+"statements","POST",r,this.lrs.auth,e,{id:i},null,s,this.withCredentials,this.strictCallbacks);if(!e)return{xhr:o,id:i}}},XAPIWrapper.prototype.stringToArrayBuffer=function(t,e){return e=e||ADL.XAPIWrapper.defaultEncoding,new TextEncoder(e).encode(t).buffer},XAPIWrapper.prototype.stringFromArrayBuffer=function(t,e){return e=e||ADL.XAPIWrapper.defaultEncoding,new TextDecoder(e).decode(t)},XAPIWrapper.prototype.buildMultipartPost=function(t,e,n){t.attachments=[];for(var i=0;i<e.length;i++)"signature"==e[i].type&&(e[i].type={usageType:"http://adlnet.gov/expapi/attachments/signature",display:{"en-US":"A JWT signature"},description:{"en-US":"A signature proving the statement was not modified"},contentType:"application/octet-stream"}),"string"==typeof e[i].value&&(e[i].value=this.stringToArrayBuffer(e[i].value)),e[i].type.length=e[i].value.byteLength,e[i].type.sha2=toSHA256(e[i].value),t.attachments.push(e[i].type);var r=[],s=(Math.random()+" ").substring(2,10)+(Math.random()+" ").substring(2,10);n["Content-Type"]="multipart/mixed; boundary="+s;var o="\r\n",a=["--"+s,"Content-Type: application/json",'Content-Disposition: form-data; name="statement"',"",JSON.stringify(t)].join(o)+o;for(var i in r.push(a),e)if(e.hasOwnProperty(i)){var p=["--"+s,"Content-Type: "+e[i].type.contentType,"Content-Transfer-Encoding: binary","X-Experience-API-Hash: "+e[i].type.sha2].join(o)+o+o;r.push(p),r.push(e[i].value)}return r.push(o+"--"+s+"--"+o),new Blob(r)},XAPIWrapper.prototype.sendStatements=function(t,e){if(this.testConfig()){for(var n in t)t.hasOwnProperty(n)&&this.prepareStatement(t[n]);var i=ADL.XHR_request(this.lrs,this.lrs.endpoint+"statements","POST",JSON.stringify(t),this.lrs.auth,e,null,!1,null,this.withCredentials,this.strictCallbacks);if(!e)return i}},XAPIWrapper.prototype.getStatements=function(t,e,n){if(this.testConfig()){var i=this.lrs.endpoint+"statements";if(e)i=this.base+e;else{var r=new Array;for(s in t)if(t.hasOwnProperty(s))if("until"==s||"since"==s){var o=new Date(t[s]);r.push(s+"="+encodeURIComponent(o.toISOString()))}else r.push(s+"="+encodeURIComponent(t[s]));0<r.length&&(i=i+"?"+r.join("&"))}var a=ADL.XHR_request(this.lrs,i,"GET",null,this.lrs.auth,n,null,!1,null,this.withCredentials,this.strictCallbacks);if(void 0===a||404==a.status)return null;try{return JSON.parse(a.response)}catch(t){return a.response}}},XAPIWrapper.prototype.getActivities=function(t,e){if(this.testConfig()){var n=this.lrs.endpoint+"activities?activityId=<activityid>";n=n.replace("<activityid>",encodeURIComponent(t));var i=ADL.XHR_request(this.lrs,n,"GET",null,this.lrs.auth,e,null,!0,null,this.withCredentials,this.strictCallbacks);if(void 0===i||404==i.status)return null;try{return JSON.parse(i.response)}catch(t){return i.response}}},XAPIWrapper.prototype.sendState=function(t,e,n,i,r,s,o,a){if(this.testConfig()){var p=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>&stateId=<stateid>";p=(p=(p=p.replace("<activity ID>",encodeURIComponent(t))).replace("<agent>",encodeURIComponent(JSON.stringify(e)))).replace("<stateid>",encodeURIComponent(n)),i&&(p+="&registration="+encodeURIComponent(i));var c=null;s&&o?log("Can't have both If-Match and If-None-Match"):s?c={"If-Match":ADL.formatHash(s)}:o&&(c={"If-None-Match":ADL.formatHash(o)});var u="PUT";if(!r)return this.log("No activity state was included."),!1;r instanceof Array?(r=JSON.stringify(r),(c=c||{})["Content-Type"]="application/json"):r instanceof Object?(r=JSON.stringify(r),(c=c||{})["Content-Type"]="application/json",u="POST"):(c=c||{})["Content-Type"]="application/octet-stream",ADL.XHR_request(this.lrs,p,u,r,this.lrs.auth,a,null,null,c,this.withCredentials,this.strictCallbacks)}},XAPIWrapper.prototype.getState=function(t,e,n,i,r,s){if(this.testConfig()){var o=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>";o=(o=o.replace("<activity ID>",encodeURIComponent(t))).replace("<agent>",encodeURIComponent(JSON.stringify(e))),n&&(o+="&stateId="+encodeURIComponent(n)),i&&(o+="&registration="+encodeURIComponent(i)),r&&null!=(r=isDate(r))&&(o+="&since="+encodeURIComponent(r.toISOString()));var a=ADL.XHR_request(this.lrs,o,"GET",null,this.lrs.auth,s,null,!0,null,this.withCredentials,this.strictCallbacks);if(void 0===a||404==a.status)return null;try{return JSON.parse(a.response)}catch(t){return a.response}}},XAPIWrapper.prototype.deleteState=function(t,e,n,i,r,s,o){if(this.testConfig()){var a=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>&stateId=<stateid>";a=(a=(a=a.replace("<activity ID>",encodeURIComponent(t))).replace("<agent>",encodeURIComponent(JSON.stringify(e)))).replace("<stateid>",encodeURIComponent(n)),i&&(a+="&registration="+encodeURIComponent(i));var p=null;r&&s?log("Can't have both If-Match and If-None-Match"):r?p={"If-Match":ADL.formatHash(r)}:s&&(p={"If-None-Match":ADL.formatHash(s)});var c=ADL.XHR_request(this.lrs,a,"DELETE",null,this.lrs.auth,o,null,!1,p,this.withCredentials,this.strictCallbacks);if(void 0===c||404==c.status)return null;try{return JSON.parse(c.response)}catch(t){return c}}},XAPIWrapper.prototype.sendActivityProfile=function(t,e,n,i,r,s){if(this.testConfig()){var o=this.lrs.endpoint+"activities/profile?activityId=<activity ID>&profileId=<profileid>";o=(o=o.replace("<activity ID>",encodeURIComponent(t))).replace("<profileid>",encodeURIComponent(e));var a=null;i&&r?log("Can't have both If-Match and If-None-Match"):i?a={"If-Match":ADL.formatHash(i)}:r&&(a={"If-None-Match":ADL.formatHash(r)});var p="PUT";if(!n)return this.log("No activity profile was included."),!1;n instanceof Array?(n=JSON.stringify(n),(a=a||{})["Content-Type"]="application/json"):n instanceof Object?(n=JSON.stringify(n),(a=a||{})["Content-Type"]="application/json",p="POST"):(a=a||{})["Content-Type"]="application/octet-stream",ADL.XHR_request(this.lrs,o,p,n,this.lrs.auth,s,null,!1,a,this.withCredentials,this.strictCallbacks)}},XAPIWrapper.prototype.getActivityProfile=function(t,e,n,i){if(this.testConfig()){var r=this.lrs.endpoint+"activities/profile?activityId=<activity ID>";r=r.replace("<activity ID>",encodeURIComponent(t)),e&&(r+="&profileId="+encodeURIComponent(e)),n&&null!=(n=isDate(n))&&(r+="&since="+encodeURIComponent(n.toISOString()));var s=ADL.XHR_request(this.lrs,r,"GET",null,this.lrs.auth,i,null,!0,null,this.withCredentials,this.strictCallbacks);if(void 0===s||404==s.status)return null;try{return JSON.parse(s.response)}catch(t){return s.response}}},XAPIWrapper.prototype.deleteActivityProfile=function(t,e,n,i,r){if(this.testConfig()){var s=this.lrs.endpoint+"activities/profile?activityId=<activity ID>&profileId=<profileid>";s=(s=s.replace("<activity ID>",encodeURIComponent(t))).replace("<profileid>",encodeURIComponent(e));var o=null;n&&i?log("Can't have both If-Match and If-None-Match"):n?o={"If-Match":ADL.formatHash(n)}:i&&(o={"If-None-Match":ADL.formatHash(i)});var a=ADL.XHR_request(this.lrs,s,"DELETE",null,this.lrs.auth,r,null,!1,o,this.withCredentials,this.strictCallbacks);if(void 0===a||404==a.status)return null;try{return JSON.parse(a.response)}catch(t){return a}}},XAPIWrapper.prototype.getAgents=function(t,e){if(this.testConfig()){var n=this.lrs.endpoint+"agents?agent=<agent>";n=n.replace("<agent>",encodeURIComponent(JSON.stringify(t)));var i=ADL.XHR_request(this.lrs,n,"GET",null,this.lrs.auth,e,null,!0,null,this.withCredentials,this.strictCallbacks);if(void 0===i||404==i.status)return null;try{return JSON.parse(i.response)}catch(t){return i.response}}},XAPIWrapper.prototype.sendAgentProfile=function(t,e,n,i,r,s){if(this.testConfig()){var o=this.lrs.endpoint+"agents/profile?agent=<agent>&profileId=<profileid>";o=(o=o.replace("<agent>",encodeURIComponent(JSON.stringify(t)))).replace("<profileid>",encodeURIComponent(e));var a=null;i&&r?log("Can't have both If-Match and If-None-Match"):i?a={"If-Match":ADL.formatHash(i)}:r&&(a={"If-None-Match":ADL.formatHash(r)});var p="PUT";if(!n)return this.log("No agent profile was included."),!1;n instanceof Array?(n=JSON.stringify(n),(a=a||{})["Content-Type"]="application/json"):n instanceof Object?(n=JSON.stringify(n),(a=a||{})["Content-Type"]="application/json",p="POST"):(a=a||{})["Content-Type"]="application/octet-stream",ADL.XHR_request(this.lrs,o,p,n,this.lrs.auth,s,null,!1,a,this.withCredentials,this.strictCallbacks)}},XAPIWrapper.prototype.getAgentProfile=function(t,e,n,i){if(this.testConfig()){var r=this.lrs.endpoint+"agents/profile?agent=<agent>";r=(r=r.replace("<agent>",encodeURIComponent(JSON.stringify(t)))).replace("<profileid>",encodeURIComponent(e)),e&&(r+="&profileId="+encodeURIComponent(e)),n&&null!=(n=isDate(n))&&(r+="&since="+encodeURIComponent(n.toISOString()));var s=ADL.XHR_request(this.lrs,r,"GET",null,this.lrs.auth,i,null,!0,null,this.withCredentials,this.strictCallbacks);if(void 0===s||404==s.status)return null;try{return JSON.parse(s.response)}catch(t){return s.response}}},XAPIWrapper.prototype.deleteAgentProfile=function(t,e,n,i,r){if(this.testConfig()){var s=this.lrs.endpoint+"agents/profile?agent=<agent>&profileId=<profileid>";s=(s=s.replace("<agent>",encodeURIComponent(JSON.stringify(t)))).replace("<profileid>",encodeURIComponent(e));var o=null;n&&i?log("Can't have both If-Match and If-None-Match"):n?o={"If-Match":ADL.formatHash(n)}:i&&(o={"If-None-Match":ADL.formatHash(i)});var a=ADL.XHR_request(this.lrs,s,"DELETE",null,this.lrs.auth,r,null,!1,o,this.withCredentials,this.strictCallbacks);if(void 0===a||404==a.status)return null;try{return JSON.parse(a.response)}catch(t){return a}}};var location=(isNode=Boolean(!root.document))?{search:"",protocol:"https:"}:root.location;function parseUrl(t){if(isNode)return require("url").parse(t);var e=document.createElement("a");return e.href=t,e}var XMLHttpRequest=root.XMLHttpRequest;function ie_request(t,e,n,i){var r=e,s=new Array,o=r.indexOf("?");if(0<o&&(s.push(r.substr(o+1)),r=r.substr(0,o)),r=r+"?method="+t,null!==n)for(var a in n)n.hasOwnProperty(a)&&s.push(a+"="+encodeURIComponent(n[a]));return null!==i&&s.push("content="+encodeURIComponent(i)),{method:"POST",url:r,headers:{},data:s.join("&")}}function _getobj(t,e){var n=e.split("."),i=n[0];return e=n.slice(1).join("."),t[i]||(/\[\]$/.test(i)?t[i=i.slice(0,-2)]=[]:t[i]={}),e?_getobj(t[i],e):t[i]}isNode&&((XMLHttpRequest=function(){this.method="GET",this.url=null,this.async=!0,this.headers={}}).prototype={open:function(t,e,n){if(!1===n)throw"ADL xAPIWrapper does not support synchronous http requests in node";this.method=t,this.url=e,this.withCredentials=!0,this.crossDomain=!0,this.responseText="",this.responseJSON=null,this.readyState=0,this.status=0,this.onreadystatechange=function(){},this.onerror=function(t){},this.onload=function(){}},setRequestHeader:function(t,e){this.headers[t]=e},send:function(t){var e=this.url.includes("https:")?require("https"):require("http"),n={method:this.method,headers:this.headers},i=parseUrl(this.url);for(var r in i)n[r]=i[r];var s=e.request(n,function(t){t.setEncoding("utf8"),this.status=t.statusCode,t.on("data",function(t){this.responseText+=t}.bind(this)),t.on("end",function(){this.readyState=4;try{this.responseJSON=JSON.parse(this.responseText)}catch(t){this.responseJSON=null}this.onload()}.bind(this))}.bind(this));s.on("error",function(t){this.readyState=4,this.onerror()}.bind(this)),s.end(t)}}),ADL.ruuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},ADL.dateFromISOString=function(t){var e=t.match(new RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T| ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?")),n=0,i=new Date(e[1],0,1);e[3]&&i.setMonth(e[3]-1),e[5]&&i.setDate(e[5]),e[7]&&i.setHours(e[7]),e[8]&&i.setMinutes(e[8]),e[10]&&i.setSeconds(e[10]),e[12]&&i.setMilliseconds(1e3*Number("0."+e[12])),e[14]&&(n=60*Number(e[16])+Number(e[17]),n*="-"==e[15]?1:-1),n-=i.getTimezoneOffset(),time=Number(i)+60*n*1e3;var r=new Date;return r.setTime(Number(time)),r},ADL.XHR_request=function(t,i,r,e,n,s,o,a,p,c,u){"use strict";var l,h,d,f,g,v,y=!1,m=!1,S=!1,A=i.toLowerCase().match(/^(.+):\/\/([^:\/]*):?(\d+)?(\/.*)?$/),b={"Content-Type":"application/json"};if(b.Authorization=n,b["X-Experience-API-Version"]=ADL.XAPIWrapper.xapiVersion,null!==p)for(var x in p)p.hasOwnProperty(x)&&(b[x]=p[x]);if((m=location.protocol.toLowerCase()!==A[1]||location.hostname.toLowerCase()!==A[2])||(m=(null===A[3]?"http"===A[1]?"80":"443":A[3])===location.port),null!==t&&void 0!==t.extended){for(g in f=new Array,t.extended)f.push(g+"="+encodeURIComponent(t.extended[g]));0<f.length&&(i+=(-1<i.indexOf("?")?"&":"?")+f.join("&"))}var I=root.XDomainRequest&&root.XMLHttpRequest&&void 0===(new XMLHttpRequest).responseType;if(m&&void 0!==I&&!1!==I)S=!0,h=ie_request(r,i,b,e),(l=new XDomainRequest).open(h.method,h.url);else for(var x in(l=new XMLHttpRequest).withCredentials=c,l.open(r,i,null!=s),b)l.setRequestHeader(x,b[x]);function w(){if(y)return d;y=!0;var t=a&&404===l.status;if(!(void 0===l.status||200<=l.status&&l.status<400||t)){var e;try{e="There was a problem communicating with the Learning Record Store. ( "+l.status+" | "+l.response+" )"+i}catch(t){e=t.toString()}return ADL.XAPIWrapper.log(e),ADL.xhrRequestOnError(l,r,i,s,o,u),d=l}if(!s)return d=l;if(o)u?s(null,l,o):s(l,o);else{var n;try{n=JSON.parse(l.responseText)}catch(t){n=l.responseText}u?s(null,l,n):s(l,n)}}if(l.onreadystatechange=function(){if(4===l.readyState)return w()},l.onload=w,l.onerror=w,l.send(S?h.data:e),!s){if(S)for(v=1e3+new Date;new Date<v&&4!==l.readyState&&!y;)delay();return w()}},ADL.xhrRequestOnError=function(e,t,n,i,r,s){if(i&&s){var o,a=e?e.status:void 0;if(o=a?new Error("Request error: "+e.status):0===a||null===a?new Error("Request error: aborted"):new Error("Reqeust error: unknown"),r)i(o,e,r);else{var p;try{p=JSON.parse(e.responseText)}catch(t){p=e.responseText}i(o,e,p)}}},ADL.formatHash=function(t){return"*"===t?t:'"'+t+'"'},ADL.XAPIWrapper=new XAPIWrapper(Config,!1);var XAPIStatement=function(t,e,n,i){if(t&&t.actor&&t.verb&&t.object){var r=t;for(var s in r)"actor"!=s&&"verb"!=s&&"object"!=s&&(this[s]=r[s]);t=r.actor,e=r.verb,n=r.object}t?t instanceof Agent?this.actor=t:"Agent"!==t.objectType&&t.objectType?"Group"===t.objectType&&(this.actor=new Group(t)):this.actor=new Agent(t):this.actor=null,this.verb=e?e instanceof Verb?e:new Verb(e):null,n?"Activity"!==n.objectType&&n.objectType?"Agent"===n.objectType?this.object=n instanceof Agent?n:new Agent(n):"Group"===n.objectType?this.object=n instanceof Group?n:new Group(n):"StatementRef"===n.objectType?this.object=n instanceof StatementRef?n:new StatementRef(n):"SubStatement"===n.objectType?this.object=n instanceof SubStatement?n:new SubStatement(n):this.object=null:this.object=n instanceof Activity?n:new Activity(n):this.object=null,i&&(this.result=i),this.generateId=function(){this.id=ADL.ruuid()}};XAPIStatement.prototype.toString=function(){return this.actor.toString()+" "+this.verb.toString()+" "+this.object.toString()+" "+this.result.toString()},XAPIStatement.prototype.isValid=function(){return this.actor&&this.actor.isValid()&&this.verb&&this.verb.isValid()&&this.object&&this.object.isValid()&&this.result&&this.result.isValid()},XAPIStatement.prototype.generateRegistration=function(){_getobj(this,"context").registration=ADL.ruuid()},XAPIStatement.prototype.addParentActivity=function(t){_getobj(this,"context.contextActivities.parent[]").push(new Activity(t))},XAPIStatement.prototype.addGroupingActivity=function(t){_getobj(this,"context.contextActivities.grouping[]").push(new Activity(t))},XAPIStatement.prototype.addOtherContextActivity=function(t){_getobj(this,"context.contextActivities.other[]").push(new Activity(t))};var Agent=function(t,e){if(this.objectType="Agent",this.name=e,t&&(t.mbox||t.mbox_sha1sum||t.openid||t.account))for(var n in t)this[n]=t[n];else/^mailto:/.test(t)?this.mbox=t:/^[0-9a-f]{40}$/i.test(t)?this.mbox_sha1sum=t:/^http[s]?:/.test(t)?this.openid=t:t&&t.homePage&&t.name&&(this.account=t)};Agent.prototype.toString=function(){return this.name||this.mbox||this.openid||this.mbox_sha1sum||this.account.name},Agent.prototype.isValid=function(){return this.mbox||this.mbox_sha1sum||this.openid||this.account.homePage&&this.account.name||"Group"===this.objectType&&this.member};var Group=function(t,e,n){Agent.call(this,t,n),this.member=e,this.objectType="Group"};Group.prototype=new Agent;var Verb=function(t,e){if(t&&t.id)for(var n in t)this[n]=t[n];else this.id=t,e&&("string"==typeof e||e instanceof String?this.display={"en-US":e}:this.display=e)};Verb.prototype.toString=function(){return this.display&&(this.display["en-US"]||this.display.en)?this.display["en-US"]||this.display.en:this.id},Verb.prototype.isValid=function(){return this.id};var Activity=function(t,e,n){if(t&&t.id){var i=t;for(var r in i)this[r]=i[r]}else this.objectType="Activity",this.id=t,(e||n)&&(this.definition={},"string"==typeof e||e instanceof String?this.definition.name={"en-US":e}:e&&(this.definition.name=e),"string"==typeof n||n instanceof String?this.definition.description={"en-US":n}:n&&(this.definition.description=n))};Activity.prototype.toString=function(){return this.definition&&this.definition.name&&(this.definition.name["en-US"]||this.definition.name.en)?this.definition.name["en-US"]||this.definition.name.en:this.id},Activity.prototype.isValid=function(){return this.id&&(!this.objectType||"Activity"===this.objectType)};var StatementRef=function(t){if(t&&t.id)for(var e in t)this[e]=t[e];else this.objectType="StatementRef",this.id=t};StatementRef.prototype.toString=function(){return"statement("+this.id+")"},StatementRef.prototype.isValid=function(){return this.id&&this.objectType&&"StatementRef"===this.objectType};var SubStatement=function(t,e,n){XAPIStatement.call(this,t,e,n),this.objectType="SubStatement",delete this.id,delete this.stored,delete this.version,delete this.authority};SubStatement.prototype=new XAPIStatement,SubStatement.prototype.toString=function(){return'"'+SubStatement.prototype.prototype.toString.call(this)+'"'},XAPIStatement.Agent=Agent,XAPIStatement.Group=Group,XAPIStatement.Verb=Verb,XAPIStatement.Activity=Activity,XAPIStatement.StatementRef=StatementRef,XAPIStatement.SubStatement=SubStatement,ADL.XAPIStatement=XAPIStatement;var onBrowser="undefined"!=typeof window,getObjDefName=function(t){if(t.definition&&t.definition.name)return ADL.xapiutil.getLangVal(t.definition.name)},getSubStatementDisplay=function(t){if("SubStatement"===t.objectType&&("SubStatement"!==t.object.objectType&&!(t.id||t.stored||t.version||t.authority)))return ADL.xapiutil.getActorId(t.actor)+":"+ADL.xapiutil.getVerbDisplay(t.verb)+":"+ADL.xapiutil.getObjectId(t.object)};function getQueryVariable(t){for(var e=location.search.substring(1).split("&"),n=0;n<e.length;n++){var i=e[n].split("=");if(decodeURIComponent(i[0])==t)return decodeURIComponent(i[1])}}function cb_wrap(i){return function(){var n=arguments;setTimeout(function(){for(var t=[],e=0;e<n.length;e++)t.push(n[e]);i.apply(window,t)},0)}}function observeForNewLinks(){var t=document.body;new MutationObserver(function(t){t.forEach(function(t){for(var e in t.addedNodes){if(t.addedNodes.hasOwnProperty(e))if(t.addedNodes[e].constructor==HTMLAnchorElement)setupCourseLinks([t.addedNodes[e]])}})}).observe(t,{attributes:!0,childList:!0,subtree:!0})}function setupCourseLinks(t){var e="xAPILaunchKey="+getQueryVariable("xAPILaunchKey")+"&xAPILaunchService="+getQueryVariable("xAPILaunchService");getQueryVariable("encrypted")&&(e+="&encrypted=true");for(var n=0;n<t.length;n++){var i=t[n],r=i.href,s=i.attributes.getNamedItem("courselink");s&&"true"==s.value&&(r=-1<r.indexOf("?")?r+"&"+e:r+"?"+e,i.href=r)}}function xAPILaunch(s,o,a){if(isNode)throw"ADL.launch not supported in node";s=cb_wrap(s);try{var i=getQueryVariable("xAPILaunchKey"),r=getQueryVariable("xAPILaunchService");getQueryVariable("encrypted");if(xAPILaunch.terminate=function(t){var e=new URL(r);e.pathname+="launch/"+i+"/terminate";var n=new XMLHttpRequest;n.withCredentials=!0,n.crossDomain=!0,n.open("POST",e.toString(),!1),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify({code:0,description:t||"User closed content"}))},!i||!r)return s("invalid launch parameters");var t=new URL(r);t.pathname+="launch/"+i;var p=new XMLHttpRequest;p.withCredentials=!0,p.crossDomain=!0,p.onerror=function(t){setTimeout(function(){return s(t)})},p.onload=function(t){if(200!==p.status)return p.onerror(p.responseText);var e=JSON.parse(p.responseText),n=e,i={};i.endpoint=n.endpoint,i.actor=n.actor,i.withCredentials=!0,i.strictCallbacks=a||!1,root.onunload=function(){o&&xAPILaunch.terminate("User closed content")};var r=new ADL.XAPIWrapper.constructor;return r.changeConfig(i),setupCourseLinks(document.body.querySelectorAll("a")),observeForNewLinks(),s(null,e,r)},p.open("POST",t.toString(),!0),p.send()}catch(t){s(t)}}ADL.xapiutil={},ADL.xapiutil.getLang=function(){var t;if("undefined"!=typeof navigator)t=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;else if("undefined"!=typeof process&&void 0!==process.env&&void 0!==process.env.LANG){var e=process.env.LANG;t=(t=e.slice(0,e.indexOf("."))).replace(/_/,"-")}return t||"en-US"},ADL.xapiutil.getLangVal=function(t){if(t&&0!=Object.keys(t).length){for(var e,n=ADL.xapiutil.getLang(),i=!1;t[n]?(e=t[n],i=!0):n.indexOf("-")&&(n=n.substring(0,n.lastIndexOf("-"))),!i&&""!==n;);return e}},ADL.xapiutil.getMoreStatements=function(i,r,s){if(!onBrowser)throw new Error("Node not supported.");var o=[];ADL.XAPIWrapper.getStatements(s,null,function t(e){if(e&&e.response){var n=JSON.parse(e.response);n.statements&&(o=o.concat(n.statements),i--<=0?r(o):n.more&&""!==n.more?ADL.XAPIWrapper.getStatements(s,n.more,t):""===n.more&&r(o))}})},ADL.xapiutil.getActorId=function(t){return t.mbox||t.openid||t.mbox_sha1sum||t.account},ADL.xapiutil.getActorIdString=function(t){var e=t.mbox||t.openid||t.mbox_sha1sum;return e||(e=t.account?t.account.homePage+":"+t.account.name:t.member?"Anon Group "+t.member:"unknown"),e},ADL.xapiutil.getActorDisplay=function(t){return t.name||ADL.xapiutil.getActorIdString(t)},ADL.xapiutil.getVerbDisplay=function(t){if(t)return t.display&&ADL.xapiutil.getLangVal(t.display)||t.id},ADL.xapiutil.getObjectType=function(t){return t.objectType||(t.id?"Activity":"Agent")},ADL.xapiutil.getObjectId=function(t){if(t.id)return t.id;var e=ADL.xapiutil.getObjectType(t);return"Agent"===e||"Group"===e?ADL.xapiutil.getActorId(t):void 0},ADL.xapiutil.getObjectIdString=function(t){if(!t)return"unknown";if(t.id)return t.id;var e=ADL.xapiutil.getObjectType(t);return"Agent"===e||"Group"===e?ADL.xapiutil.getActorIdString(t):"SubStatement"==e?getSubStatementDisplay(t):"unknown"},ADL.xapiutil.getObjectDisplay=function(t){if(!t)return"unknown";var e=getObjDefName(t)||t.name||t.id;if(!e){var n=ADL.xapiutil.getObjectType(t);"Agent"===n||"Group"==n?e=ADL.xapiutil.getActorDisplay(t):"SubStatement"==n&&(e=getSubStatementDisplay(t))}return e};var isNode;location=(isNode=Boolean(!root.document))?{search:"",protocol:"https:"}:root.location;ADL.launch=xAPILaunch;
//# sourceMappingURL=xapiwrapper.min.js.map
    return ADL;
}));
